<!doctype html>
<html>
<head>
    <!-- <meta charset="UTF-8">  -->
    <meta name="viewport" content="width=device-width, maximum-scale=1.0 minimum-scale=1.0 initial-scale=1.0 user-scalable=0" charset="UTF-8">
    <meta name="mobile-web-app-capable" content="yes">
    <!--
    <meta name="HandheldFriendly" content="true">
    html {
    -webkit-text-size-adjust: none
    } -->
    <title>Bible Map</title>
    <!-- <link rel="apple-touch-icon" sizes="146x146" href="biblemap/image/biblemap_logo_114x114.png?version=20180214" />  -->

    <script>
        var userAgent = navigator.userAgent.toLowerCase();
        if(userAgent.match('iphone')) {
            document.write('<link rel=\"apple-touch-icon\" sizes=\"146x146\" href=\"biblemap/image/biblemap_logo_114x114.png?version=20180214\" />');
        } else if(userAgent.match('ipad')) { // sizes="72*72"
            document.write('<link href=\"biblemap/image/biblemap_logo_124x117.png\" rel=\"apple-touch-icon\" >');
        } else if(userAgent.match('ipod')) {
            document.write('<link href=\"biblemap/image/biblemap_logo_124x117.png\" rel=\"apple-touch-icon\">');
        } else if(userAgent.match('android')) {
            document.write('<link href=\"biblemap/image/biblemap_logo_124x117.png\" rel=\"shortcut icon\">');
        } else {
            document.write('<link href=\"biblemap/image/biblemap_logo_124x117.png\" rel=\"shortcut icon\">');
        }
    </script>

    <link rel="stylesheet" href="https://openlayers.org/en/v4.4.2/css/ol.css" type="text/css">
    <link rel="stylesheet" href="biblemap/css/m_main.css" type="text/css">
    <link rel="stylesheet" href="biblemap/css/m_sidebar.css?version=20170916" type="text/css">
    <link rel="stylesheet" type="text/css" media="all" href="biblemap/css/bubblePopup.css?version=20171210">        <!-- 지도상의 버블 팝업 -->
    <link rel="stylesheet" type="text/css" media="all" href="biblemap/css/m_autocomplete_style.css?version=20170911">
    <link rel="stylesheet" type="text/css" media="all" href="biblemap/css/m_tooltip.css?version=20170911">

    <!-- <link rel="stylesheet" type="text/css" media="all" href="biblemap/css/autocomplete_style.css?version=20170911">  -->
    <!-- <link rel="stylesheet" type="text/css" media="all" href="biblemap/css/popup.css?version=20170910">  -->
    <link rel="stylesheet" type="text/css" media="all" href="biblemap/css/m_tabMenu.css?version=20170916">
    <link rel="stylesheet" type="text/css" media="all" href="biblemap/css/m_bubblePopup.css?version=20171210">
    <link rel="stylesheet" type="text/css" media="all" href="biblemap/css/m_popup.css?version=20170910">

    <script type="text/javascript" src="biblemap/src/m_include.js"></script>

    <script type="text/javascript" src="https://code.jquery.com/jquery-2.2.3.min.js"></script>
    <script type="text/javascript" src="biblemap/src/common.js?version=20170830"></script>

    <script type="text/javascript" src="biblemap/js/matchMedia.js-master/matchMedia.js"></script>
    <script type="text/javascript" src="biblemap/js/matchMedia.js-master/matchMedia.addListener.js"></script>
    <script type="text/javascript" src="biblemap/openLayers_v4.4.2/ol.js"></script>
    <script type="text/javascript" src="biblemap/src/jQueryRotate.js"></script>

    <script type="text/javascript" src="biblemap/src/openLayersControl.js?version=20180201"></script>
    <script type="text/javascript" src="biblemap/src/m_downloadLayers.js?version=20180201"></script>

    <script type="text/javascript" src="biblemap/src/arc.js?version=20170813"></script>
    <script type="text/javascript" src="biblemap/src/common.js?version=20170830"></script>
    <script type="text/javascript" src="biblemap/lib/binaryajax.js?version=20170813"></script>
    <script type="text/javascript" src="biblemap/src/binarywrapper.js?version=20170813"></script>
    <script type="text/javascript" src="biblemap/src/GMDFileReader.js?version=20170901"></script>
    <script type="text/javascript" src="biblemap/src/propertyDB.js?version=20170813"></script>
    <script type="text/javascript" src="biblemap/src/GMDFileDownload.js?version=20170905"></script>
    <!-- <script type="text/javascript" src="biblemap/src/contentTextProc.js?version=20180121"></script>  -->
    <script type="text/javascript" src="biblemap/src/httpRequest.js?version=20170829"></script>
    <script type="text/javascript" src="biblemap/src/makeHrefText.js?version=20170829"></script>
    <script type="text/javascript" src="biblemap/src/m_requestPoiContent.js?version=20170829"></script>

    <script type="text/javascript" src="biblemap/src/m_searchBible.js?version=20170901"></script>
    <script type="text/javascript" src="biblemap/js/jquery.autocomplete.min.js"></script>
    <script type="text/javascript" src="biblemap/src/m_windowAdjust.js"></script>
    <script type="text/javascript" src="biblemap/src/m_poiTooltip.js"></script>

    <style stype="text/css">
        ::-webkit-scrollbar {
            width: 8px;
        }

        /* Track */
        ::-webkit-scrollbar-track {
            -webkit-box-shadow: inset 0 0 6px rgba(240,240,240,0.3);
            -webkit-border-radius: 10px;
            border-radius: 10px;
        }

        /* Handle */
        ::-webkit-scrollbar-thumb {
            -webkit-border-radius: 10px;
            border-radius: 10px;
            background: rgba(240,240,240,0.8);
            -webkit-box-shadow: inset 0 0 6px rgba(0,0,0,0.5);
        }
        ::-webkit-scrollbar-thumb:window-inactive {
            background: rgba(240,240,240,0.8);
        }


        div > span {
            font-family: 'Nanum Gothic';
        }

        div > select {

            font-family: 'Nanum Gothic';
            /* font-size: 12px;  */
            font-size:1.3em ;
            padding-left: 5px;
            height:20px;

            background-color: rgb(255,255, 255);
            border: 1px solid rgb(217, 217, 217);
        }

        .customSelect{
            background: url('biblemap/image/down_arrow.png') no-repeat 100% 50%; /* 네이티브 화살표를 커스텀 화살표로 대체 */
            background-color: rgb(255,255, 255);

            border-radius: 0px; /* iOS 둥근모서리 제거 */
            -webkit-appearance: none; /* 네이티브 외형 감추기 */
            -moz-appearance: none;
            appearance: none;
        }

        /* 화살표 없애기 for IE10, 11*/
        div > select::-ms-expand {
            display: none;
        }

        div > input {
            font-family: 'Nanum Gothic';
            /* font-size: 12px;  */

            font-size:1.3em ;

            -moz-user-select : text;
            -webkit-user-select : text;
            -ms-user-select : text;
            user-select : text;
            border: 1px solid rgb(217, 217, 217);
        }

        .inputClass {
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
            font-size: 5px;
        }

        .customInput {
            font-family: 'Nanum Gothic';
            font-size: 12px;

            -moz-user-select : text;
            -webkit-user-select : text;
            -ms-user-select : text;
            user-select : text;
            border: 1px solid rgb(217, 217, 217);
        }

        .divContent{
            line-height: 1.7em;
            font-size:1.3em ;
            clear: both;
            /* text-align:center;  */
            font-family: 'Nanum Gothic';
        }

    </style>

</head>
<body>

<div class="wrapperDiv">
    <div id="titlebar" style="position:absolute; left:0px; top:0px; height:40px;  background-color:rgb( 32, 67, 109  );">
    <!-- <div id="titlebar" style="position:absolute; left:0px; top:0px; height:40px;  background-color:rgb( 77, 162, 253 );">  -->
        <h1 align="center" style="position:absolute; top: 5px; color:white; background: rgb( 32, 67, 109 ); " >성경지도</h1>
        <!-- <input type="image" src="biblemap/image/biblemap_logo.png" style="position:absolute; left:0px; top:0px; width:45px; height:45px; vertical-align:middle; border:0;" onclick="openMenu()">  -->
        <input type="image" src="biblemap/image/m_menu_open.png" style="position:absolute; left:5px; top:5px; width:35px; height:30px; vertical-align:middle; border:0;" onclick="openMenu()">
        <input id ="bibleMapLogo" type="image" src="biblemap/image/biblemap_logo.png" style="position:absolute; top:0px; width:41opx; height:41px; vertical-align:middle; border:0;" onclick="showIntroBibleMap()">
    </div>
</div>

<!-- <div id="sideMenu"  oncontextmenu="return false" ondragstart="javascript:return false" onselectstart="javascript:return false" onkeydown="return false" >  -->
 <div id="sideMenu"  >
    <div id="logo" style="height:40px; background-color:rgb( 65, 140, 255 );" >
        <h1 align="center" style="position:absolute; height:35px; top: 5px; color:white; " >검색메뉴</h1>
    </div>
    <div class="close" >
    </div>

    <div id ="bibleSearch" style="position:absolute; left: 10px; top:50px; height: 100px; ">
        <select id ="bibleTitle"  class="customSelect" name="bibleTitle" style="position: absolute; left: 40px; top:5px; width: 180px; height:32px; font-size:1.5em;" ></select>
        <input id ="decChapter" type="image" src="biblemap/image/left_arrow.png?version=20170906" style="position: absolute; left: 40px; top:40px; width:30px; height:30px; vertical-align:middle; " onclick="mobileDecreaseBibleChapter()">
        <!-- <input id ="bibleChapter" type="number" class="chapterNum"  style="position: absolute; padding-left: 5px; left: 76px; top: 40px;  width: 40px; height: 30px; font-size:1.5em;" value="1" onchange="examineNumber()">  -->
        <input id ="bibleChapter" type="tel" class="chapterNum"  style="position: absolute; padding-left: 5px; left: 76px; top: 40px;  width: 40px; height: 30px; font-size:1.5em;" value="1" >
        <span style="position: absolute; left: 120px; top: 44px; font-size:1.5em;">장</span>
        <input id ="incChapter" type="image" src="biblemap/image/right_arrow.png?version=20170906" style="position: absolute;  left: 145px;  top:40px; width:30px; height:30px; vertical-align:middle;" onclick="mobileIncreaseBibleChapter()">
        <input type="image" src="biblemap/image/m_search_btn2.png?version=20170905" style="position: absolute; left: 190px;  top:40px; width:30px; height:30px; vertical-align:middle; border:none;"
                onclick="mobileSearchBibleChapter( footerMenuMiddle )">
    </div>

    <!-- <div name="searchWord" style="position:absolute; left: 10px; top:130px; width: 230px; height: 50px; ">  -->
    <div id="dvSearchWord" style="position:absolute; left: 10px; top:130px; width: 230px; height: 50px; ">
        <!-- <img src="image/word_search2.png" style="width:20px; height:22px; vertical-align:middle" ><input type="text" id ="bibleWord" size="12" style="font-size:12px;" value="바울"><input type="button" value="검색" style="font-size:12px;" onclick="searchBibleWord()"> -->
        <span style="position: absolute; left: 0px; top: 4px; width: 40px; font-size:1.3em;">단어</span>

        <!-- <form action="#" method="post" autocomplete="on" onSubmit="mobileSearchBibleWord()" >  -->
        <!-- <form method="post" autocomplete="on" onSubmit="mobileSearchBibleWord()" >
            <input id ="bibleWord" type="search"  class="customInput" maxlength="9" style="position: absolute; padding-left: 5px; padding-right:50px; left: 40px; width:180px; height:30px; font-size:1.3em; vertical-align:middle;"  value="바울"  />
         </form>  -->
        <input id ="bibleWord" type="text"  class="customInput" maxlength="9" style="position: absolute; padding-left: 5px; padding-right:25px; left: 40px; width:150px; height:30px; font-size:1.5em; vertical-align:middle;"  value="바울"  />

        <input type="image" src="biblemap/image/m_text_clear.png?version=20170905" style="position: absolute; left: 163px;  top:3px; width:25px; height:25px; vertical-align:middle; border:none;"  onclick="clearSearchBibleWord()">
        <input type="image" src="biblemap/image/m_search_btn2.png?version=20170905" style="position: absolute; left: 192px;  top:0px; width:30px; height:30px; vertical-align:middle; border:none;"  onclick="mobileSearchBibleWord()">
    </div>

    <div style="position:absolute; top: 165px; width: 249px; height: 14px; background: url(biblemap/image/horizon-line_2.png);"></div>

    <div id="biblePlaceDiv" class="content" style ="position: absolute; left: 10px; width:230px; top: 190px; height: 200px; ">
        <span style="position: absolute; top: 4px; left: 3px;  font-size:1.5em;">지명</span>
        <!-- <input id="biblePlace" type="text" name="currency" class="biginput"  size="16" maxlength="9"  -->

            <input id="biblePlace" type="text" name="currency" class="biginput"  size="16" maxlength="9"
               style="position: absolute; padding-left: 5px; left: 40px; width: 150px; height:30px; font-size:1.5em; font:'Nanum Gothic'; " value="갈릴리 호수" />

        <input type="image" src="biblemap/image/m_text_clear.png?version=20170905" style="position: absolute; left: 163px;  top: 3px; width:25px; height:25px; vertical-align:middle; border:none;"  onclick="clearSearchPlaceWord()">
        <input type="image" src="biblemap/image/location3.png?version=20170908" style="position: absolute; left: 196px;  top: 0px; width:20px; height:30px; vertical-align:middle; border:none; "  onclick="mobileSearchBiblePlace()">
        <div style="height: 4px"></div>
        <!--
        <select id ="searchedPoiList" class="customSelect" name="searchedPoiList" style="position: absolute; overflow:hidden; left: 0px; top:40px; width: 160px; height:30px; border: 1px solid #D9D9D9; " ></select>
        <input type="image" src="biblemap/image/m_search_btn2.png?version=20170905" style="position: absolute; left: 170px; top:40px; width:30px; height:30px; vertical-align:middle; "  onclick="searchPoiList()">
        -->
        <div id ="searchedPoiList" rows= "5" style="border:1px solid rgb(217, 217, 217); overflow:scroll; position: absolute; left:5px; top: 40px; height: 75px; width: 202px; padding-left: 5px; font-size:1.5em ;text-align : left; ">
          <!--  <a href ="javascript:clearSearchPlaceWord()" style="text-decoration:none; color:rgb(0,0,0); text-align : left;">베다니1</a><br>
            <a href ="javascript:clearSearchPlaceWord()" style="text-decoration:none; color:rgb(0,0,0); text-align : left;">베다니2</a><br> -->
        </div>
    </div>

</div>

<div id="map" class="mapview" style="position:absolute; top:41px;" >

    <!-- <div id="dummy" style="position:absolute; left:50px; top:0px; height:30px; background-color: white;">테스트</div>  -->

    <input id="compassBtn" type="image" src="biblemap/image/compass3.png?version=20170930"  style="position: absolute; border:0; width: 55px; height: 55px;"  onclick="setRotateNorth()">

    <!-- <input id="zoomInBtn2D" type="image" src="biblemap/image/m_zoom_in.png?version=20171204"  style="border:1px solid #A0A0A0; position: absolute; width:35px; height: 35px; border:none;"  -->
    <input id="zoomInBtn2D" type="image" src="biblemap/image/plus_btn2.png?version=20171204"  style="position: absolute; width:35px; height: 35px; border:1px solid rgb(170, 170, 170);"
           onclick="map2DZoomIn()">
    <!-- <input id="zoomOutBtn2D" type="image" src="biblemap/image/m_zoom_out.png?version=20171204" style="border:1px solid grey;  position: absolute; width:35px; height: 35px; border:none;"-->
    <input id="zoomOutBtn2D" type="image" src="biblemap/image/minus_btn2.png?version=20171204" style="position: absolute; width:35px; height: 35px; border:1px solid rgb(170, 170, 170);"
           onclick="map2DZoomOut()">
    <input id="homeBtn" type="image" src="biblemap/image/home.png?version=20170930"
           style="position: absolute; width:35px; height: 35px; border:none;" onclick="gotoHome()">
</div>

<div id="footer"  style="border-top: 1px solid rgb(220, 220, 220);" >
    <!-- <div id ="tabTitle"  style ="height: 40px;">  -->
        <ul id="tabsMenu" class="tabs" style="position: absolute;" >
            <li id="tab1Menu" class="active" rel="tab1">성경본문</span></li>
            <li id="tab2Menu" rel="tab2"><span style="font-color:white; ">단어검색</span></li>
            <li id="tab3Menu" rel="tab3">지명정보</li>
        </ul>
     <!-- </div>  -->
    <div id ="tab_contain" class="tab_container" >
        <!-- <div id = "tab1Title" class="divContent" style="padding-left: 40px;  font-size: 1.5em; top:-6px; overflow-x:hidden; border-bottom: 1px solid rgb(240, 240, 240);" >  -->
        <div id = "tab1Title" class="divContent" style="padding-left: 20px; font-weight: bold; font-size: 1.25em; top:-6px; height: 33px; overflow-x:hidden; color: rgb( 90, 90, 90 );" >
            <span id ="tabBibleBook" style="position: absolute; left: 5px; top: 0px; width:120px; font-size:1.2em; text-align:right;" ></span>
            <input id="tabDecBible" type="image" src="biblemap/image/left_arrow.png?version=20170907" style="position: absolute; left: 130px; width:22px; height:26px; vertical-align:middle; " onclick="mobileDecreaseBibleChapterAndGo()">
            <span id ="tabBibleChapter" style="position: absolute; left: 150px; width:70px; top: 0px; font-size:1.2em; text-align:center;">장</span>
            <input id="tabIncBible" type="image" src="biblemap/image/right_arrow.png?version=20170907" style="position: absolute; left: 215px; top: 0px; width:22px; height:26px; vertical-align:middle;" onclick="mobileIncreaseBibleChapterAndGo()">
        </div>

        <!-- <div id = "tab3Title" class="divContent" style="padding-left: 10px;  font-size: 1.5em; top:-6px; height: 35px; overflow-x:hidden; border-bottom:4px solid rgb(230, 230, 230);" > </div>  -->
        <div id = "tab3Title" class="divContent" style="padding-left: 10px;  font-size: 1.5em; top:-6px; height: 35px; overflow-x:hidden; color: rgb( 90, 90, 90 ); " > </div>

        <div id="tab1" class="tab_content" style="padding-left: 5px; padding-right:5px; border-top: 1px solid rgb(225, 225, 225); -webkit-overflow-scrolling:touch;">
        </div>
        <div id="tab2" class="tab_content" style="padding-left: 5px; padding-right:5px;  -webkit-overflow-scrolling:touch;" >
            성경&nbsp;단어&nbsp;검색&nbsp;버튼을&nbsp;클릭해&nbsp;주세요 <br>
            <a href ="javascript:gotoSearchWord()" style="text-decoration:none; font-weight: bold; fong-size: 1.5em; color:rgb(47, 145, 253); text-align : left;">→ 바로가기 클릭!!</a><br>
        </div>
        <div id="tab3" class="tab_content" style="left: -5px; padding-left: 5px; padding-right:5px;  background-color:rgb(245, 245, 245); border-top:1px solid rgb(225, 225, 225); -webkit-overflow-scrolling:touch; "  >
            지명 정보의 검색결과가&nbsp; 없습니다 <br> 지도상의&nbsp;지명을&nbsp;클릭하고&nbsp;아이콘'i'를&nbsp;클릭해&nbsp;주세요&nbsp;
        </div>
    </div>

    <div id = "missionWideIntro" style="height:40px;" >
        <input id ="missionWideLogo" type="image" src="biblemap/image/mission_wide_logo.png?version=20170905" style="position: absolute; left: 15px;  top: 3px; width:160px; height:30px; vertical-align:middle; border:none;" >
        <!-- <div style="position:absolute; padding-left: 165px; top: 8px; font-size: 1.4em; color: rgb( 70, 70, 70);">기부/후원 안내</div> -->
        <!--       onclick="clearSearchPlaceWord()">  -->
    </div>
    <input id ="footUpArrow" type="image" src="biblemap/image/up_arrow.png?version=20170910" style="position: absolute; left: 250px;  top: 3px; width:25px; height:25px; vertical-align:middle; border:none;"  onclick="footerUp()">
    <input id ="footDownArrow" type="image" src="biblemap/image/down_arrow.png?version=20170910" style="position: absolute; left: 280px;  top: 3px; width:25px; height:25px; vertical-align:middle; border:none;"  onclick="footerDown()">

    <!-- .tab_container -->
</div>

<div id="bubblePopup" class="ol-popup" style="font-size:1.1em;">
    <a href="#" id="popup-closer" class="ol-popup-closer" ></a>
    <div style="height: 8px"></div>
    <div id="popup-content" class="ol-popup-content" style="text-align:center; font-size: 1.2em;"></div>
</div>


<!-- <div id="infoPopup" class="pop-layer" style = "width : 550px; height: 620px;" oncontextmenu="return false" ondragstart="javascript:return false" onselectstart="javascript:return false" onkeydown="return false" >  -->
<div id="infoPopup" class="pop-layer" style = "width : 90%; height: 90%;" oncontextmenu="return false" ondragstart="javascript:return false" onselectstart="javascript:return false" onkeydown="return false" >
    <div class="pop-container" >
        <div>
            <span id ="noticeTitle" style="font-size:1.5em; ">
           </span>

        </div>

        <div id ="contentDiv" style = "position: absolute; overflow-y:scroll; line-height:24px; border-left: 1px solid #DDD;  border-right: 1px solid #DDD; border-bottom: 1px solid #DDD;">
        <!-- <div id ="contentDiv" style = "overflow-y:scroll; line-height:24px; ">  -->
            <span id ="noticeContent" style="font-size:1.4em; text-align:center; ">
           </span>
        </div>
        <div id ="noticeClose" class="btn-r" style = "position: absolute;" >
            <a href="#" class="btn-layerClose">Close</a>
        </div>
    </div>
</div>


<div id="downloadingDiv" style ="position:absolute; ">
    <img src ="biblemap/image/downloading.gif?version=20170905">
</div>


<script>

    setDebug( true );

    /*
    var userAgent = navigator.userAgent.toLowerCase();
    if(userAgent.match('iphone')) {
        alert("iphone!!!");
        // document.write('<link rel="apple-touch-icon-precomposed" href="biblemap/image/biblemap_logo_114x114.png" >');
        document.write('<link rel=\"apple-touch-icon\" sizes=\"146x146\" href=\"biblemap/image/biblemap_logo_114x114.png?version=20180214\" />');
    } else if(userAgent.match('ipad')) { // sizes="72*72"
        document.write('<link href=\"biblemap/image/biblemap_logo_124x117.png\" rel=\"apple-touch-icon\" >');
    } else if(userAgent.match('ipod')) {
        document.write('<link href=\"biblemap/image/biblemap_logo_124x117.png\" rel=\"apple-touch-icon\">');
    } else if(userAgent.match('android')) {
        document.write('<link href=\"biblemap/image/biblemap_logo_124x117.png\" rel=\"shortcut icon\">');
    } else {
        document.write('<link href=\"biblemap/image/biblemap_logo_124x117.png\" rel=\"shortcut icon\">');
    }
    */



    /*
    $( '#dummy' ).css( "z-index", 2000 );
    var dummy = document.getElementById( 'dummy' );
    dummy.innerHTML = "하하하하";
    */

    preventZoomInDIV( 'sideMenu' );
    preventZoomInDIV( 'titlebar' );
    preventZoomInDIV( 'footer' );
    preventZoomInDIV('tab1Title');
    preventZoomInDIV('infoPopup');
    preventZoomInDIV('biblePlaceDiv');

    (function(){        // prevent for double tap
        var lastTap = 0;
        var timeout;

        function preventEvent(evt){
            var currentTime = new Date().getTime();
            var tapLength = currentTime - lastTap;

            evt.preventDefault();
            clearTimeout(timeout);
            ConsoleLog("preventEventDefault()");

            if(tapLength < 1000 && tapLength > 0){
                evt.preventDefault();
                lapTap = 0;
            }else{
                timeout = setTimeout(function(){
                    clearTimeout(timeout);
                }, 1000);
            }
            lastTap = currentTime;
        }

        $('#incChapter').on('touched click', preventEvent );
        $('#decChapter').on('touched click', preventEvent );
        $('#sideMenu').on('touched click', preventEvent );

        $('#tabDecBible').on('touched click', preventEvent );
        $('#tabIncBible').on('touched click', preventEvent );

        // $('#biblePlaceDiv').on('touched click', preventEvent );
    }());



    (function(){        // prevent for double tap
        var lastTap = 0;
        var timeout;

        function preventEvent(evt){
            var currentTime = new Date().getTime();
            var tapLength = currentTime - lastTap;

            evt.preventDefault();
            clearTimeout(timeout);

            if(tapLength < 1000 && tapLength > 0){
                alert("!!!!");
                evt.preventDefault();
                lapTap = 0;
            }else{
                var targetElement = evt.target || evt.srcElement;
                // alert("yes");
                //alert( targetElement.id );
                hideMenuAndMoveToPoiID( targetElement.id  );
                // targetElement();
                // Array.prototype.slice.call(arguments, 1);

                // Array.prototype.slice( targetElement, 1);

                // targetElement.apply();
                timeout = setTimeout(function(){
                    clearTimeout(timeout);
                    // lapTap = 0;
                }, 1000);
            }
            lastTap = currentTime;
        }


        $('#searchedPoiList').on('touched click', preventEvent );
    }());


    /*
    document.documentElement.addEventListener('touchmove', function (event) {
        event.preventDefault();
    }, false);
    */

    showDownloading();

    $( '#bubblePopup' ).css( "z-index", 10 );
    $( '#zoomInBtn2D' ).css( "z-index", 100 );
    $( '#zoomOutBtn2D' ).css( "z-index", 100 );
    $( '#homeBtn' ).css( "z-index", 100 );

    checkLocalStorageEnabled();

    $("#searchedPoiList").hide();

    var focusPoiObj = null;

    var footerMenu = createFooterMenu();

    function footerDown(){
        var mode = footerMenu.getMode();
        if( mode == "top"){
            footerMenu.middle();
        }
        else if( mode == "middle"){
            footerMenu.bottom();
        }else if( mode == "bottom" ){
            alert("!!!");
        }
    }

    function footerUp(){
        var mode = footerMenu.getMode();
        if( mode == "bottom"){
            footerMenu.middle();
        }
        else if( mode == "middle"){
            footerMenu.top();
        }else if( mode == "top" ){
            alert("!!!");
        }
    }

    function footerShow(){
        var mode = footerMenu.getMode();
        if( mode == "bottom" || mode == "hide" ){
            footerMenu.middle();
        }
    }

    var downloadGeomTimer = null;
    var IsDownload = false;

    var dvPopupContainer = document.getElementById('bubblePopup');
    dvPopupContainer.setAttribute("id", "popupContainer" );
    $( '#popupContainer' ).css( "z-index", 2000 );


    var dvPopupContent = document.getElementById('popup-content');
    var dvPopupCloser = document.getElementById('popup-closer');

    var dvBibleTitle = document.getElementById('bibleTitle');
    var dvBibleChapter = document.getElementById('bibleChapter');

    var beforeChapterSearchParam = { type: "Args",     // book, chapter, paragraph 등으로 구성된 검색
        option: { "title": "",
            "chapter" : ""
        }
    };

    var dvBibleWord = document.getElementById("bibleWord");
    var dvBiblePlace = document.getElementById("biblePlace");

    dvBibleChapter.addEventListener('change', function(){
        if(isNaN( dvBibleChapter.value ) == true) {
            alert( "숫자를 입력해 주세요");
        }
        else{
            var inputChapterNum = parseInt( dvBibleChapter.value);
            var chapter = bibleChapterList.getChapterByNumber( parseInt( dvBibleTitle.value) );
            if( chapter.lastNum < inputChapterNum ){
                dvBibleChapter.value = chapter.lastNum.toString();
            }
        }

    });


    function examineNumber(){
        ConsoleLog( "input Number : " + dvBibleChapter.value );
        alert( dvBibleChapter.value  );
        if(isNaN( dvBibleChapter.value ) == true) {
            alert("숫자를 입력해 주세요");
        }
    }

    function clearSearchBibleWord(){
        dvBibleWord.value = "";
        $("#bibleWord").focus();
        //alert( "clar!!");
    }

    function clearSearchPlaceWord(){
        $("#searchedPoiList").hide();
        dvBiblePlace.value ="";
        $("#biblePlace").focus();
    }

    var bibleChapterList = new BibleChapterList();

    bibleChapterList.setCallback( function(){
        startDownloadGeometries();

        for( var order = 1; order <= bibleChapterList.getCount(); order ++  ) {
            var chapter = document.createElement("option");
            var obj =  bibleChapterList.getChapterByNumber( order );
            chapter.text = obj.title;
            chapter.value = obj.bookNumber;
            dvBibleTitle.appendChild( chapter );
        }

        getSearchWordsFromStorage();
        // mobileSearchBibleChapter();
    } );

    // bibleChapterList.requestBibleChapter();

    dvBibleTitle.addEventListener("change", function(e){
        dvBibleChapter.value = "1";
        // mobileSearchBibleChapter();
    });

    /*
    dvBibleWord.addEventListener("change", function(e){
        mobileSearchBibleWord();
    });
    */

    $('#bibleWord').click( clickedBibleWordInput );
    function clickedBibleWordInput(){
        // alert("Clicked!!");
    }


    $('.chapterNum').bind('keyup mouseup', function(){
        // mobileSearchBibleChapter();
    } );

    var beforeChapterSearchParam = { type: "Args",     // book, chapter, paragraph 등으로 구성된 검색
        option: { "title": "",
            "chapter" : ""
        }
    };

    // $("#searchedPoiList").click( function(){
    function searchPoiList() {
        $("#sideMenu").removeClass("open");
        moveToPlaceSelPoiTitle("#searchedPoiList");
    }
    // });

    function moveToPlaceSelPoiTitle( selectId ){
        var selPoiId = $( selectId ).val();
        moveToPlaceByPoiID( selPoiId );
    }


    function createOverlay( divID ){    // container
        var overlay = new ol.Overlay( ({
            element: divID,
            autoPan: true,
            autoPanAnimation: {
                duration: 250
            }
        }));
        return overlay;
    }

    var overlay = createOverlay( dvPopupContainer );

    var popup2D = {
        name : "2D",
        overlay : overlay,
        content : dvPopupContent,
        closer : dvPopupCloser
    };

    popup2D.closer.onclick = function() {
        popup2D.overlay.setPosition(undefined);
        popup2D.closer.blur();
        popup2D.content.innerHTML = "";

        /*
        if( footerMenu.getMode() == "middle" )
            footerMenu.bottom();
            */

        return false;
    };

    var bibleMapManager = createMapManager( popup2D.overlay, 'map' );
    var layerManager = bibleMapManager.getLayerManager();
    var bibleMap = bibleMapManager.getMap();

    var poiTooltip = new mapTooltip( bibleMap, 'tooltip tooltip-static' );


    function startDownloadGeometries(){
        downloadGeomTimer = setInterval(downloadGeometries, 100);
    }

    bibleMapManager.mapEventPrecompose( function(evt){

        var radian = bibleMapManager.getView().getRotation();
        var mapAngle = radian * (180/ Math.PI);
        if( mapAngle < 0 ){
            mapAngle = 360 + mapAngle;
        }

        mapAngle = Math.floor( mapAngle );
        var nAngle = parseInt( mapAngle );
        $("#compassBtn").rotate( nAngle);
    });


    bibleMapManager.mapEventPostcompose( function(evt){

        if( IsDownload == false ) {
            bibleChapterList.requestBibleChapter();
            ConsoleLog("Postcompse !!!!  requestBibleChapter !!! ");
            IsDownload = true;
        }


        var curZoom = bibleMap.getView().getZoom();
        /*
        dummy.innerHTML = "zoom : " + curZoom;
        dummy.innerHTML += '<br>';
        */

        /*
        var view2D = bibleMap.getView();
        var center2D = view2D.getCenter();
        dummy.innerHTML += "X: " + center2D[0] + "," + "Y:" + center2D[1];
        */

    });

    ///////////////////////////////////////////////////

    function openMenu(){
        $("#sideMenu").addClass("open");
        document.getElementById("sideMenu").focus();
    }

    $(".close").click(function() {
        $("#sideMenu").removeClass("open");
        document.getElementById("map").focus();
    });

    function gotoSearchWord() {
        $("#sideMenu").addClass("open");
        $("#bibleWord").focus();
    }


    function createTabMenu(){

        //document.body.requestFullscreen();

        $(".tab_content").hide();
        $(".tab_content:first").show();

        var selMenuString = "";

        $("ul.tabs li").click(function () {
            selMenuString = $(this).text();
            ConsoleLog( "tab Click !!! select : " + selMenuString );
            $("ul.tabs li").removeClass("active").css("color", "#FFFFFF");
            $(this).addClass("active").css("color", "#000000");
            $(".tab_content").hide();

            if( selMenuString == "성경본문"){
                $("#tab1Title").show();
            }else{
                $("#tab1Title").hide();
            }
            if( selMenuString == "지명정보"){
                $("#tab3Title").show();
                /*
                var infoTab3 = document.getElementById( 'tab3' );
                if( infoTab3.innerHTML.length > 10 )
                    $("#tab3Title").show();
                else{
                    alert("검색결과가 없습니다 지도상의 지명을 클릭하고 아이콘 \'i\'를 클릭해 주세요");
                }*/
            }else{
                $("#tab3Title").hide();
            }

            var activeTab = $(this).attr("rel");
            ConsoleLog( "tab Click !!! rel Active : " + activeTab );
            // $("#" + activeTab).fadeIn();
            $("#" + activeTab).show();
        });

        TabMenuControl = function() {
            this.selectTab = function (menuID) {
                // var el = document.getElementById('tab1Menu');
                var el = document.getElementById(menuID);
                eventFire(el, 'click');
            };

            this.getSelectedTabString = function () {
                return selMenuString;
            };

            return this;
        };

        return new TabMenuControl;
    }


    var tabMenu = createTabMenu();

    $(window).on("orientationchange", function(event) {

        if( window.matchMedia("(orientation: portrait)").matches){
            // alert("가로");
            console.log("세로");
            // middleFooter();
            footerMenu.showControl();
        }else if( window.matchMedia("(orientation: landscape)").matches){
            // alert("세로");
            console.log("가로");
            setTimeout( function(){ window.scrollTo(0, 1); }, 100 );
            // middleFooter();
            footerMenu.showControl();
        }

    });

    $(document).ready(function(){
        // middleFooter();
        footerMenu.showControl();
        tabMenu.selectTab( 'tab1Menu');

        ConsoleLog("window.ready!!!");
    });


    window.onresize = function(){
        // middleFooter();
        footerMenu.showControl();
    };


    IsExistWord = function( array, word ) {
        for (var id in array ) {
            var curObj = array[id];
            if( curObj.value == word) {
                return true;
            }
        }
        return false;
    };


    // 지명 검색창에 지명 입력시 자동으로 후보단어 표시하기
    function initTextAutoComplete(){

        var currencies = [];
        var poiDic = layerManager.getPoiDictionaryObj();

        for( prop in poiDic ){
            if( poiDic.hasOwnProperty(prop) && typeof poiDic[prop] === "object" ){
                if( IsExistWord( currencies,  prop ) == false) {
                    currencies.push({value: prop});
                }
            }
        }

        $('#biblePlace').autocomplete({
            lookup: currencies,
            onSelect: function (suggestion) {
                // var thehtml = '<strong>Currency Name:</strong> ' + suggestion.value + ' <br> <strong>Symbol:</strong> ' + suggestion.data;
                // $('#outputcontent').html(thehtml);

                var dvBiblePlace = document.getElementById("biblePlace");
                dvBiblePlace.value = suggestion.value;
                mobileSearchBiblePlace();
            }
        });
    }


    var downloadGeometries = function(){

        clearInterval( downloadGeomTimer );

        layerManager.layerContainer.totalCount = mobileBibleMapPointLayers.length;

        for( var idx in mobileBibleMapPointLayers ){
            var layer = mobileBibleMapPointLayers[idx];

            new GMDFileDownload( bibleMap, null, layer.url, layer.order, layer.style, layerManager, function( ){
                layerManager.sortPoiWords();
                 mobileSearchBibleChapter( );
                initTextAutoComplete();
                // hideDownloading();
                setTimeout( hideDownloading, 500);
            } );
        }

    };


    window.onload = function(){
        // downloadGeometries();
        // downloadGeomTimer = setInterval( downloadGeometries, 1000);
        // mobileSearchBibleChapter(  );
        ConsoleLog("window.onload!!!");
    };



    function closePopup2D(){
        popup2D.closer.onclick();
    }


    function showPopup( position, content ){
        popup2D.content.innerHTML = content;
        popup2D.overlay.setPosition( position );
    }


    function mobileSearchBiblePlace() {
        if (dvBiblePlace.value == "") {
            return;
        }

        dvBiblePlace.value = removeSpaceInWord(dvBiblePlace.value);

        saveSearchWordsToStorage();

        var dvSearchedPoiList = document.getElementById("searchedPoiList");
        dvSearchedPoiList.innerHTML = "";

        var strHrefText = "";

        var poiArray = layerManager.getPoiObjArrayFromDictionary( dvBiblePlace.value );

        if( poiArray.length > 1 ) {
            $("#searchedPoiList").show();

            dvSearchedPoiList.innerHTML = "<ol>";

            for (var idx in poiArray) {
                ConsoleLog(  "id : " +  poiArray[idx].id + ", Find POI : " + poiArray[idx].biblePlace + ", title : " + poiArray[idx].title);
                /*

                var tempString = '<a href=' + '"javascript:hideMenuAndMoveToPoiID( ' + poiArray[idx].id + ')\" style=\"text-decoration:none; color:rgb(0,0,0);\" >';
                tempString += poiArray[idx].title;
                tempString += '</a>';
                if( idx < poiArray.length )
                    tempString += '<br>';
                    */

                var tempString = '<li id=\"' + poiArray[idx].id + '\">' +  poiArray[idx].title + '</li>';

                strHrefText += tempString;
            }
            dvSearchedPoiList.innerHTML += strHrefText;
            dvSearchedPoiList.innerHTML += "</ol>";
        }else{
            $("#searchedPoiList").hide();
            poiObj = poiArray[0];
            hideMenuAndMoveToPoiID( poiObj.id );
        }
_
    }

    function hideMenuAndMoveToPoiID( poiID ){
        $("#sideMenu").removeClass("open");
        if( footerMenu.getMode() == "top" || footerMenu.getMode() == "middle")
            footerMenu.bottom();

        moveToPlaceByPoiID( poiID );
    }



    function moveToPlaceByPoiID( poiID ){
        if( poiID == null )
            return;

        if( footerMenu.getMode() == "top" )
            footerMenu.middle();

        var poiObj = layerManager.getPoiObjById( poiID );

        layerManager.historyInsertPoi( poiObj );

        moveToPlaceByPoiObj( poiObj );
    }


    function moveToPlaceByPoiObj( poiObj ){
        if( poiObj == null )
            return;


        // requestPoiContentAndShow( poiObj, popup2D, popup3D );     // poi의  youtube나 기타 컨텐츠를 보여 줄수 있도록 mongodb 검색
        mobileRequestPoiContentAndShow( poiObj );     // poi의  youtube나 기타 컨텐츠를 보여 줄수 있도록 mongodb 검색

        var curZoom2D = bibleMap.getView().getZoom();

        var view2D = bibleMap.getView();
        var center2D = view2D.getCenter();
        var curExtent2D = view2D.calculateExtent(bibleMap.getSize());

        var extentLength2D = getDistance( curExtent2D[0], curExtent2D[1], curExtent2D[2], curExtent2D[3]);
        var moveDistance2D = getDistance( center2D[0], center2D[1], poiObj.x, poiObj.y );
        ///////////////////////////////////////////////////////////

         moveMap( moveDistance2D, extentLength2D, view2D, curZoom2D, poiObj );
    }


    moveMap = function( moveDistance, extentLength, view, curZoom, poiObj ) {

        var mapBaseExtent = bibleMapManager.getMapBaseExtent();

        var mapExtent = bibleMap.getView().calculateExtent(bibleMap.getSize());
        var curZoom = bibleMap.getView().getZoom();
        var mapExtentDistance = getDistance( mapExtent[0],mapExtent[1], mapExtent[2], mapExtent[3] );
        var mapCenter =  bibleMap.getView().getCenter();
        var poiDistance = getDistance( mapCenter[0], mapCenter[1], poiObj.x, poiObj.y );
        var isFar = false;
        if( mapExtentDistance < poiDistance )
            isFar = true;

        var poiZoomIn = poiObj.zoomIn;

        if( IsIntersectExtent( mapBaseExtent, poiObj.x, poiObj.y ) == true) {    // 기본 지도 영역 이내에 있으면
            if( poiZoomIn < 6){
                poiZoomIn = 7.8;
            }else{
                poiZoomIn -= 1;
            }

            // if( curZoom < poiZoomIn ){
            var tolerance = Math.abs( curZoom - poiZoomIn );
            if( tolerance > 1){
                poiZoomIn = ( curZoom + poiZoomIn ) / 2.0;
            }else{
                poiZoomIn = curZoom;
            }
            moveTo(view, [poiObj.x, poiObj.y], poiZoomIn );
        }else{
            if( poiZoomIn < 6 )
                poiZoomIn = 6.5;
            else
                poiZoomIn -= 1;

            if( isFar == true ) {
                flyTo(view, [poiObj.x, poiObj.y], poiZoomIn, function (complete) {
                    if (complete == true) {
                    }
                });
            }else{
                if(IsIntersectExtent( mapExtent, poiObj.x, poiObj.y ) == true) {    // 현재 지도 영역 이내에 있으면
                    moveTo(view, [poiObj.x, poiObj.y], curZoom );
                }
                else {
                    moveTo(view, [poiObj.x, poiObj.y], poiZoomIn);
                }
            }
        }

        /*
        var poiZoomIn = poiObj.zoomIn;
        if( adjustZoomIn < 6){   // 국가가 보여지는 레벨
            adjustZoomIn = 6;
            if( IsIntersectExtent( mapBaseExtent, poiObj.x, poiObj.y ) == true){    // 기본 지도 영역 이내에 있으면
                adjustZoomIn = 9;
                if( isFar == true ){        // 이동거리가 멀다면
                      moveTo(view, [poiObj.x, poiObj.y], adjustZoomIn );
                }
                else {
                    //if (curZoom < adjustZoomIn) {
                        moveTo(view, [poiObj.x, poiObj.y], curZoom);
                    //}else{
                     //   moveTo(view, [poiObj.x, poiObj.y], adjustZoomIn );
                    // }
                }
            }
            else {
                flyTo(view, [poiObj.x, poiObj.y], adjustZoomIn, function (complete) {
                    if (complete == true) {
                    }
                });
            }
        }else{
            if (curZoom < adjustZoomIn) {
                if( curZoom < 9 ){
                    moveTo(view, [poiObj.x, poiObj.y], 9 );
                }else {
                    moveTo(view, [poiObj.x, poiObj.y], curZoom);
                }
            } else {
                adjustZoomIn -= 0.3;
                moveTo(view, [poiObj.x, poiObj.y], adjustZoomIn);
            }
        }
        */

    };

    bibleMapManager.clickEvent( function(evt){
        var clickedPos = evt.coordinate;
        // $("#mousePosition").html( "Pos X: " + clickedPos[0] + ", Y:" + clickedPos[1] ); // + zoom;

        closeTooltip();
        ConsoleLog( "Map2D Click!!!! ");

    });

    bibleMapManager.singleClickEvent( function(evt){
    });


    bibleMapManager.selectFeatureEvent( function(e) {

        var selLen = e.selected.length;
        if (selLen < 1)
            return;

        beforeChapterSearchParam = { type: "Args",     // book, chapter, paragraph 등으로 구성된 검색
            option: { "title": "",
                "chapter" : ""
            }
        };

        var feature = e.selected[0];    // 첫번째 걸린 것만 가져오기로 하자
        var layer = feature.getLayer(bibleMap);
        var id = layer.get("id");

        var pos = null;

        var posName = feature.get("label");     //  OpenLayersControl.js 내에  createTextStyleOfFeature 함수에서  text: feature.get('label') 으로 설정되어 있음
        var poiID = feature.get("id");     //  OpenLayersControl.js 내에  createTextStyleOfFeature 함수에서  text: feature.get('label') 으로 설정되어 있음

        showPoiInfoInTab = function( ) {
            if (focusPoiObj !== null && focusPoiObj.id == poiID ) {
                footerMenu.middle();

                setCenterFocusedPOI( focusPoiObj );

                // poiContentsToTab(infoText);
                tabMenu.selectTab('tab3Menu');
                $("#tab3").scrollTop(0);
            }
        };

        // var zoom3D = map3D.view.getZoom();

        if (posName == null) {      // polygon 레이어를 클릭했을 경우
            posName = feature.get("name");      // History admin polygon에는 name과 name2 필드가 존재함
            if (posName == null)
                return;
            if (id < 5) {          // 전세계 폴리곤 경계라면...
                posName = "<strong>현재 국가</strong><br>" + "&nbsp;" + posName;

                showPopup( bibleMapManager.getClickecPos(), posName );

            } else {    // 나머지 폴리곤에 정의된 "name" 필드로 검색하도록 한다

                showPopup( bibleMapManager.getClickecPos(), posName );

                var poiArray = layerManager.getPoiObjArrayFromDictionary( posName );
                if( poiArray.length < 2){
                    var poiObj = poiArray[ 0];
                    layerManager.historyInsertPoi( poiObj );
                    mobileRequestPoiContentAndShow( poiObj, showPoiInfoInTab  );     // poi의  youtube나 기타 컨텐츠를 보여 줄수 있도록 mongodb 검색
                }
            }
        } else {        //  poi Layer를 선택했을 경우
            if (id < 5) {          // 전세계 폴리곤 경계라면...
                var nationName = posName;
                posName = "<strong>현재 국가</strong><br>" + "&nbsp;" + posName;
                showPopup( bibleMapManager.getClickecPos(), posName );
            } else {    // 나머지 폴리곤에 정의된 "name" 필드로 검색하도록 한다

                var poiObj = layerManager.getPoiObjById( poiID );
                layerManager.historyInsertPoi( poiObj );
                mobileRequestPoiContentAndShow( poiObj , showPoiInfoInTab );     // poi의  youtube나 기타 컨텐츠를 보여 줄수 있도록 mongodb 검색
            }
        }

    });


    function map2DZoomIn(){
        bibleMapManager.zoomIn();
    }

    function map2DZoomOut(){
        bibleMapManager.zoomOut();
    }

    function gotoHome(){
        //moveTo( bibleMapManager.getView(), [3844176, 3806822 ], 7 );
        moveTo( bibleMapManager.getView(), [3937988, 3763366 ], 7.4  );
        setRotateNorth();
    }

    var setRotateNorth = function() {

        bibleMapManager.getView().animate({
            rotation: 0,
            duration : 500
        });

    };



</script>
</body>
</html>