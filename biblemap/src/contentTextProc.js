/**
 * Created by Administrator on 2017-06-13.
 */


function getHistoryAdminStringObj( number ) {


    var strArray = [ { title: "약속의 땅 가나안",
        text: "이스라엘 백성은 애굽에서 430여년간의 긴 노예생활을 끝으로 하나님의 인도하심에 따라 모세가 이끄는 대로 애굽을 탈출하여 하나님께서 약속하신 약속의 땅 가나안으로 떠나게 된다<br> \
            이스라엘이 출애굽하여 11일 정도면 약속된 땅 가나안에 갈 수 있었지만, 40년의 광야생활을 통하여 \
            입성하게 되었다 <br> 모세는 눈앞에 가나안 땅을 두고 생을 다하게 되고, 여호수아가 이스라엘의 새 지도자가 되어 가나안 땅 \
            의 주변 원주민들과의 전쟁에서 승리하여 가나안 땅에 정착하게 된다" },
        { title: "출애굽 후 12지파",
            text: "출애굽 이후 이스라엘 백성이 가나안 정착을 위해 요단 강을 건너기 전, 모세가 임종이 다가왔을때 요단 동편의 땅을 12지파 중에서 르우벤, 갓, 므낫세 세 지파에게 기업으로 주었다<br>\
            이는 그들이 요단 강 동편에 이르기까지 이들이 앞서서 전쟁에서 승리할 수 있었기 때문이었다 <br>\
	    이 세 지파를 제외한 나머지 9지파에 대한 기업분배는 모세가 죽고 난 후, 여호수아가 요단 강을 건너 가나안 땅의 원주민들과 전쟁하여 5년 후에 이루어진다<br>\
	    인구와 병력이 가장 많았던 유다지파는 가장 넓은 영토를 분배받았고, 그 넓은 영토중에서 가운데 일부를  인원수가 가장 적은 시므온 지파에게 준다<br>\
	    지도에서 보는 바와 같이 유다지파의 땅이 시므온 지파의 땅을 포함하고 있음을 볼 수 있다 <br>\
	    다음으로 여호수아가 속한 에브라임 지파는 유다의 북쪽에 위치한 땅을 분배받고, 므낫세의 반지파가 요단강 기준 서쪽에 분배를 받고,  에브라임 지파가 중앙의 땅을 분배 받는다<br>\
	    이렇게 11지파가 땅을 분배받는 동안 레위 지파는 땅을 분배받지 못하고 48개의 성읍에 흩어져서 이스라엘 백성들에게 하나님의 말씀과 율법을 지키도록 사명을 감당하게 된다<br>" },

        /* http://www.subkorea.com/bible/study/bibles/history/history05.html */
        { title: "사사 시대(BC 12C)",
            text: "하나님의 은총으로 이스라엘 백성이 선민이 되어 가나안을 정복하고 그 곳에 정착하게 된 이스라엘은 하나님의 언약백성으로서 하나님의 말씀에 순종하는 삶을 살아야 했다 <br>\
            그러나 이스라엘 백성들은 타락하여 여호와 하나님을 버리고 우상을 숭배하며 동족끼리 분열하였으며, 따라서 남아있던 이방 족속들이 압제하게 되었다 <br>\
            그 결과 고통에 빠진 백성들은 하나님께 회개하며 여호와께 부르짖게 된다 <br>\
            하나님은 이를 지켜보시고 이들의 기도에 응답하여 때에 따라 사사를 세우셔서 구원해 주셨다 <br>\
            그러나 이스라엘 백성들은 평화가 지속되면 다시 타락하였으며, 타락과 심판 그리고 회개, 구원의 반복의 악순환이 지속되게 된다 <br>\
        사사시대에는 이처럼 이스라엘 백성이 하나님앞에 불성실하였지만 하나님은 끝까지 이스라엘 백성을 사랑하셨으며 신실하신 구속사를 이어가셨다<br>\
        성경말씀 - 사사기, 룻기, 삼상(1~3 장)" },

        /* http://www.subkorea.com/bible/study/bibles/history/history06.html  */
        { title: "사울왕 시대 이스라엘",
            text: "사사 시대 이후 이스라엘 백성은 혼란의 사사 시대를 끝으로 제사장인 사무엘에게 국가차원의 왕정 체제를 요구하였다 <br>\
            제사장 사무엘 자녀들의 여러가지 병폐가 원인이 있었지만 하나님께서는 이러한 왕정체제를 원치 않으셨다<br>\
            결국 이스라엘 백성의 바램으로 제사장 사무엘이 하나님의 명을 받아 기스의 아들 사울을 왕으로 삼고 기름부음을 하게 된다<br>\
        왕이된 사울은 암몬의 나하스가 쳐들어 왔을때 야베스를 포위하자 33만 대군을 이끌고 전쟁에서 승리하였으며, 게바에 있는 블레셋의 수비대까지 물리치게 된다<br>\
            아들 요나단 또한 베냐민 땅에 있는 블레셋을 무찔렀으며 21만의 병력으로 아말렉을 공격하여 이집트에서 몰아내어 사울은 이스라엘의 왕으로서 자리를 굳히게 된다<br>\
        그러나 사무엘이 사울에게 왕으로 기름을 부으면서 하나님의 명대로 행할것을 명하였으나 사울은 이를 어기고 결국 하나님과의 관계가 멀어져 회복할 수 없게 된다<br>\
            하나님은 이에 사울왕 대신에 다윗을 이스라엘의 새로운 왕으로 계획하셨고, 블레셋과의 전쟁 가운데 다윗이 골리앗을 물리치면서 다윗이 새로운 왕으로서 등극하게 되며 \
            후에 하나님의 뜻에따라 다윗이 이스라엘을 통치하게 된다 " } ,
        {  title : "다윗왕 시대 이스라엘",
            text : "사울왕이 집권할 당시 다윗은 베들레헴에 사는 이새의 막내아들로서 양치기일을 주로 하였다 <br>\
            그러나 하나님의 계획하심에 따라 다윗을 이스라엘의 새로운 왕으로 명하셨고 사무엘은 그 명에 따라 기름을 부어 왕으로 삼았다<br>\
        블레셋과의 전쟁에서 다윗은 사울왕의 신의를 입어 출정하여 골리앗을 죽이고 그 여세로 이스라엘 백성에게 높은 신임을 얻게 된다<br>\
            이를 불안하게 여긴 사울왕은 다윗을 죽이기 위해 찾아다녔고 다윗은 도피생활을 하였으며, 그 와중에 사울왕국은 분열되고 있었고\
        다윗은 그를 따르는 강력한 추종 세력과 함께 시글락을 얻게 된다<br>\
            그 후 사울은 블레셋과의 전쟁에서 목숨을 잃게 되었지만(삼상 31:4) 다윗은 블레셋을 정벌하고 아말렉을 진멸하였으며 헤브론에서 이스라엘의 왕으로 등극하게 된다 (삼하 5:3)<br>\
    그 이후 예루살렘성을 정복하였으며 다윗 궁을 건축하기에 이른다" },
        { title : "북이스라엘과 남유다",
            text : "다윗에 이어 솔로몬이 왕이 된 후 이스라엘 통일 왕국은 건재하였으나 하나님 앞에 죄를 지은 솔로몬의 죄악과 함께 솔로몬의 아들 르호보암의 통치력 부재로 결국 남과 북으로 분열되고 만다<br>\
            솔로몬은 느밧의 아들 여로보암의 용맹함과 부지런함을 보고 요셉 집의 강제 노역의 감독자로 임명하였는데 선지자 아히야가 그를 만나 이스라엘이 남과 북으로\
            갈라진다는 예언을 하였으며 이를 알게된 솔로몬이 여로보암을 죽이려 하였다<br>\
        이에 여로보암은 목숨을 구하기 위하여 애굽으로 도망하였다가 솔로몬이 죽고나서 다시 이스라엘로 돌아오게 된다<br>\
        돌아온 여로보암은 10지파의 지지를 받아 르호보암의 통치에 불만을 품은 이스라엘의 백성들과 함께 북 이스라엘을 세우고, 르호보암은 이스라엘의 남쪽 유다를 통치하게 된다<br>\
            남과 북으로 갈라진 이스라엘은 사사기때와 마찬가지로 하나님과의 관계가 멀어지고 암흑기를 맞게 된다"
            },
        { title : "BC 7C 앗수르 제국",
            text : "< 역대하 33:10 - 11 > <br> \
            여호와께서 므낫세와 그 백성에게 이르셨으나 저희가 듣지 아니한 고로 <br>\
            여호와께서 앗수르 왕의 군대 장관들로 와서 치게 하시며 저희가 므낫세를 사로잡고 쇠사슬로 결박하여 바벨론으로 끌어간지라 <br>\
        < 이사야 10:5 - 7 > <br> \
    앗수르 사람은 화 있을진저 그는 내 진노의 막대기요 그 손의 몽둥이는 내 분노라<br> \
    내가 그를 보내어 경건하지 아니한 나라를 치게 하며 내가 그에게 명령하여 나를 노하게 한 백성을 쳐서 탈취하며 노략하게 하며 또 그들을 길거리의 진흙 같이 짓밟게 하려 하거니와<br> \
    그의 뜻은 이같지 아니하며 그의 마음의 생각도 이같지 아니하고 다만 그의 마음은 허다한 나라를 파괴하며 멸절하려 하는도다<br> <br>\
    BC 900년 대에 앗수르가 니느웨로 수도를 옮기고 강력한 군사력으로 메소보다미아를 지배하며 영토확장을 지속하였다 <br>\
    당시 이스라엘은 르호보암이 통치하는 남유다와 여로보암이 다스리는 북이스라엘로 분열되어 있었으며 그 주변에 강력한 국가가 존재하지 않았다 <br>\
    BC 740년 경 앗수르 제국은 대군을 이끌고 분열되어 있던 이스라엘을 공격하였으며 북이스라엘의 호세아 왕은 조공을 바쳐 국가의 멸망 위기를 모면했지만 <br>\
    조공드리기를 지속하지 않는 한편 애굽에 도움을 요청함을 본 앗수르왕은 이를 배반으로 여기고 이스라엘을 포위했다 (열하 17:3-5) <br>\
    그로 부터 3년 후 앗수르는 다시 쳐들어와서 사마리아를 취하고, 이스라엘인들은 포로가 되어 메대까지 끌려가게 된다 (열하 17:6)<br>\
    이 사건으로 사마리아인들은 유대인들로 부터 배척을 당하게 되는 계기가 되는데, 앗수르는 여러 민족을 이주시켜 사마리아 사람들과 이방인들이 결혼하도록 하였기 때문이다<br>\
    결국 북이스라엘 10지파는 멸망하게 되고, 앗수르왕 산헤립은 히스기야 왕이 다스리는 남유다 정복을 위해 애를 쓰지만(열하 18:13),\
    히스기야의 간절한 기도(열하 19:14 - 19) 를 들으신 하나님께서 보호하여 앗수르는 되돌아가고 만다 <br>\
    앗수르 왕 산헤립의 뒤를 이은 에살핫돈이 왕이 되어(열하 19:37)  시리아와 남유다 왕국을 포함하여 이집트까지 정복하게 되어 앗수르 최고의 전성기를 누리게 된다 "
        },
        { title : "BC 6C 바벨론 제국",
            text : "< 열하 24:1-2 > <br> \
            여호야김 시대에 바벨론의 왕 느부갓네살이 올라오매 여호야김이 삼 년간 섬기다가 돌아서 그를 배반하였더니  <br>\
            여호와께서 그의 종 선지자들을 통하여 하신 말씀과 같이 갈대아의 부대와 아람의 부대와 모압의 부대와 암몬 자손의 부대를 여호야김에게로 보내 유다를 쳐 멸하려 하시니 <br>\
        < 열하 24:7 > <br> \
            애굽 왕이 다시는 그 나라에서 나오지 못하였으니 이는 바벨론 왕이 애굽 강에서부터 유브라데 강까지 애굽 왕에게 속한 땅을 다 점령하였음이더라 <br>\
        < 열하 24:15-17 > <br> \
        그가 여호야긴을 바벨론으로 사로잡아 가고 왕의 어머니와 왕의 아내들과 내시들과 나라에 권세 있는 자도 예루살렘에서 바벨론으로 사로잡아 가고<br>\
    또 용사 칠천 명과 장인과 대장장이 천 명 곧 용감하여 싸움을 할 만한 모든 자들을 바벨론 왕이 바벨론으로 사로잡아 가고<br>\
    바벨론 왕이 또 여호야긴의 숙부 맛다니야를 대신하여 왕으로 삼고 그의 이름을 고쳐 시드기야라 하였더라 <br><br>\
    바벨론은 유브라데 강 주위에 세워진 국가로서 BC 2 세기 부터 중요한 문화적 중심지로 학자들은 예측하고 있다. <br>\
            바벨론은 BC 7세기 경 앗수르가 강대국이 되었을때 앗수르의 지배를 받아야만 했으며, 앗수르의 왕 디글랏빌레셀 3세에 의해 침략을 받게 된다. <br>\
            앗수르의 왕 사르곤이 죽고 난 후, 주변국들은 앗수르에 저항하기 시작했으나 앗수르 산헤립 왕의 공격으로 바벨론은 다시 커다란 피해를 입게 된다.  <br>\
        그러나 유다 왕국의 이사야와 히스기야의 하나님을 향한 기도에 응답하심으로 앗수르의 산헤립왕은 죽고(대하 32:20-21),  바벨론은 신 바벨론으로 재건하기 시작한다. <br>\
        BC 6세기 경 바벨론 제국은 앗수르의 수도 니느웨를 점령하였으며, 갈그미스를 점령하려했던 애굽을 물리치고 유다 왕국의 여호와김을 바벨론의 신하로 삼는다. <br>\
    그 후 2년동안 유다 왕국은 바벨론의 속국에 괴롭힘을 당해야만 했다. (렘 52: 28- 30) <br>\
    바벨론의 왕 느부갓네살은 유다 왕으로 시드기야를 세웠으며 유다 왕국의 왕이된 시드기야는 애굽에 도움을 요청하여 바벨론에 대항하려 하였지만  <br>\
    바벨론의 침략으로 애굽은 전쟁에서 패하고 유다 왕국의 예루살렘은 포위당하게 된다. <br>\
        애굽에 도움을 요청하는 것에 대하여 예레미야는 반대했지만 이를 듣지 않은 시드기야는 결국 참담한 패배를 겪게 된 것이며, 예루살렘 성전은 불타게 된다. <br>\
        느부갓네살 왕은 바벨론을 가장 부흥하게 만든 왕이었으며, BC 587년 유다 왕국이 멸망하면서 시드기야 왕을 비롯한 유대인들이 바벨론으로 잡혀가는 고통의 역사를 겪게 된다 <br><br>\
    '주요이동경로' 메뉴에서 '이스라엘의 바벨론유수'를 선택하여 이동경로를 확인하면 바벨론의 흥함과 유다 왕국의 멸망을 파악 할 수 있다.<br><br>\
    - 바이블 맵 - <br><br>\
     다니엘 선지자는 바벨론 제국을 ‘정금 머리’와 ‘독수리 날개 달린 사자’로 표현하고 있다.<br> \
            큰 신상의 머리가 바벨론인 것은 바벨론이 최초의 문명건설 국가로서 하나님께 대적하는 우상 종교와 세상 권력의 터전을 닦았기 때문이다.<br> \
            또한 독수리 날개 달린 사자는 바벨론이 사자처럼 용맹하고 독수리처럼 빠르게 주변 국가들을 정복하며 대제국을 건설하였지만 하나님께서 독수리의 날개를 뽑을 때 추락하는 것은 순간임을 의미한다(단 7:4).<br> \
    바벨론은 날개 잃은 독수리가 순식간에 추락하듯 불과 1세기도 안되어 페르시아 제국에 멸망당하고 말았다.<br> \
        그러나 바벨론은 하나님의 구원역사가 종료될 때까지 없어지지 않는 상징적인 나라로 성경에 기록돼 있다.<br> \
        요한계시록 18:2에서는 ‘큰 성 바벨론’으로 불리며 역사 이래 하나님께 대적하는 모든 세속 문명을 상징한다.<br> \
        여기서 중요한 점은 그 큰 성 바벨론이 과거에 망했던 것처럼 미래에도 세 갈래로 갈라져 재기불능의 상태로 완전 멸망하게 된다는 점이다(계 16:19).<br> \
    아무리 위대하고 거대한 제국을 이루었다 해도 결국 개인과 국가의 역사를 섭리하시는 이는 바로 하나님이시다.<br> \
        화려했던 옛날의 바벨론은 오늘날 전쟁의 폐허와 굶주림만 가득한 땅이 되어 옛 명성을 찾기가 힘들어졌다. <br> \
‘내가’ 건설하고 ‘내 위엄의 영광’을 나타내려 하는 순간 모든 것은 물거품이 되고 만다는 사실을 바벨론제국의 흥망성쇠를 통해 깨닫는다.<br><br>\
    - 참평안 홈페이지 -  <br> "
        },
        { title : "현재의 국가",
            text : "전세계의 현재 국가는 지도상에서 237개국에 이르며, UN 회원국의 수는 193개국이다 <br>" +
            "이 가운데 하나님의 역사를 간직한 이스라엘과 관련한 국가는 이스라엘, 팔레스타인, 레바논, 시리아, 요르단, 이집트가 있으며 아브라함의 이동경로와 메소보다미아, 니느웨를 포함한 이라크가 있다" }
        ];

    return strArray[ number ];
}


function examinRightWordinText( strWord, strText ){
    var strPos = strText.indexOf(strWord);
    if( strPos == -1 ){
        return false;
    }

    if( strPos == 0 )
        return true;

    if( strText.substring(strPos-1, strPos) != " " ){
        return false;
    }
    return true;
}

function IsFindLocationWord( contentText, locationWord ){

    if( locationWord == "시므온"){
        ConsoleLog( ".....");
    }

    var addStr = [ " ", "와 ", "과 ", "으로 ", "이라 ", "에 ", "에서 " , "부터 ", "까지 ", "를 ", "을 ", "이 ", "로 ", "의 "  ];

    for( var idx in addStr ){
        var pos = contentText.indexOf( locationWord + addStr[idx] );
        if( pos  > -1 ) {
            return true;
        }
    }

    return false;
}


// 검색어이긴 하지만 지도 데이터에 없을때 보라색
//  검색어이긴 하지만 지도 데이터에 있을때 군청색
//  텍스트 내에 지도 데이터가 있을 때 초록색
// #9C1AC8  - 보라색,  #0D63DB - 군청색 , #238106 초록색
function makeStrongWordInText( LayerManager, strWord, bibleTitle, bibleText, color , bIsPlaceName ) {
    var strongStart = "<strong><font color='" + color + "'>";
    var strongEnd = "</font></strong>";

    var strPos = bibleText.indexOf(strWord);
    if (strPos == -1) {
        return bibleText;
    }

    if (strPos > 0 && bibleText.substring(strPos - 1, strPos) != " ") {
          if( bibleText.substring(strPos-1, strPos) != "'" )
                return bibleText;
    }
    if( strPos > 0 &&  ( bibleText.substring(strPos-1, strPos) == ">" || bibleText.substring( strPos + strWord.length, strPos + strWord.length + 1 ) == "<") ) {       // 이미 발견된 단어이므로 스킵
        return bibleText;
    }

    var firstFoundedPos = bibleText.indexOf("\')");       // 이미 검색된 결과가 있으면 그냥 리턴
    if( firstFoundedPos == (strPos +strWord.length) ) {
        var tempStrText = bibleText.substring( firstFoundedPos + 4, bibleText.length);

        strPos = tempStrText.indexOf(strWord );
        var secondFoundedPos = tempStrText.indexOf("</a>");
        if( secondFoundedPos == (strPos +strWord.length)){
            return bibleText;
        }
    }

    var strStrong = bibleText.substring(0, strPos);

    var poiObj = LayerManager.findPoiObjByBibleTitleAndWord( bibleTitle, strWord );
    if( poiObj ) {
            var posStart = '<a href=' + '"javascript:moveToPlaceByPoiID( ' + poiObj.id + ')\" style=\"text-decoration:none; font-weight:bold; color:' + color + '\" >';
            var posEnd = '</a>';
            strStrong += posStart;
    }
    else{
        if( bIsPlaceName == false)
            strStrong += strongStart;
    }

    strStrong += strWord;
    if( poiObj )
        strStrong += posEnd;
    else {
        if( bIsPlaceName == false )
            strStrong += strongEnd;
    }
    strStrong += makeStrongWordInText(  LayerManager, strWord, bibleTitle, bibleText.substring( strPos + strWord.length, bibleText.length ), color );

    return strStrong;
}


function makeStrongInText( LayerManager, searchWord, recvObj ) {
    var layerContainer = LayerManager.getLayerContainer();

    if( typeof recvObj === "undefined"){
        return "";
    }

    if( typeof recvObj.content === "undefined"){
        return "";
    }

    var bibleTitle = recvObj.title;     // 성경의 책권을 의미
    var bibleText = recvObj.content;
    var boolFind = false;

    for( var order in layerContainer.poiWords ) {
        var color = "";
        var placeName = layerContainer.poiWords[order].text;
        if( placeName == searchWord ) {
            boolFind = true;
            color = "#B404AE";  // 핑크색 , //  텍스트 내에 검색어와 지명이 일치할때
        }else{
            color = "#0D63DB";  // 군청색, //  텍스트 내에 지명이 있을때 군청색
        }

        bibleText = makeStrongWordInText( LayerManager, placeName, bibleTitle, bibleText, color, true );
    }


    if( boolFind == false){
        bibleText = makeStrongWordInText( LayerManager, searchWord, bibleTitle, bibleText, "#DF0101", false );  // 보라색, 검색어이긴 하지만 지도 데이터에 없을때 빨간색
    }

    return bibleText;
}


function requestPoiInfo( poiObj, recvFunc,  noRecvFunc){
    var searchParam = {
        type: "Poi",     // book, chapter, paragraph 등으로 구성된 검색
        option: {}
    };

    // searchParam.option["name"] = poiName;
    searchParam.option["name"] = poiObj.biblePlace;
    if( poiObj.title != "" ){
        searchParam.option["title"] = poiObj.title;
    }

    var jsonStr = JSON.stringify( searchParam );

    httpRequest("POST", jsonStr, function( http ) {
        var resObj = JSON.parse( http.responseText );

        if( resObj.result != "undefined" && resObj.result == "fail" ){
            ConsoleLog("requestPoiInfo() Fail!!!   param: " + jsonStr );
            if( noRecvFunc ){
                noRecvFunc( resObj );
            }
            return;
        }

        if (resObj.length != "undefined") {    // 배열로 받아올 경우
            if( resObj.length < 1){
                noRecvFunc( resObj );
                return;
            }
            for( idx in resObj ){
                var poiObj = resObj[idx];
                recvFunc( poiObj );
                break;                  // 여러개 받아오더라도 하나만 처리하도록 한다.
            }
        }
        else{
            recvFunc( resObj );
        }

    });
}


/*
function requestPoiContentAndShow( poiObj, popup, overlay ) {

    var youtube = "";
    var poiText = poiObj.biblePlace;
    if( poiObj.title != "")
        // poiText += "<br><iframe width=\"320\" height=\"200\" frameborder=\"0\" >" + poiObj.title + "</iframe>";
        poiText += "("+ poiObj.title + ")";

        requestPoiInfo( poiObj.biblePlace, function ( recvPoiObj) {
        if ( recvPoiObj.hasOwnProperty("youtube")) {
            youtube = recvPoiObj["youtube"];
        }

        if (youtube != "") {
            popup.innerHTML = poiText + "<br><iframe width=\"320\" height=\"240\" src=\"" + youtube + "\" frameborder = \"0\" allowfullscreen></iframe>";
        } else
            popup.innerHTML = poiText;
        overlay.setPosition( [poiObj.x, poiObj.y] );
    }, function () {
        popup.innerHTML = poiText;
        overlay.setPosition( [poiObj.x, poiObj.y] );
    });
}
*/



function showYoutubeOfPoi( poiObj, overlayObj, popupObj, recvPoiObj ){

    var poiText = poiObj.biblePlace;
    var youtube = "";

    if ( recvPoiObj.hasOwnProperty("youtube")) {
        youtube = recvPoiObj["youtube"];
    }
}


function showNoticePopup(el){

    $('#contentDiv').scrollTop(0);

    var $el = $(el);		//레이어의 id를 $el 변수에 저장
    var isDim = $el.prev().hasClass('dimBg');	//dimmed 레이어를 감지하기 위한 boolean 변수

    isDim ? $('.dim-layer').fadeIn() : $el.fadeIn();

    var $elWidth = ~~($el.outerWidth()),
        $elHeight = ~~($el.outerHeight()),
        docWidth = $(document).width(),
        docHeight = $(document).height();

    // 화면의 중앙에 레이어를 띄운다.
    if ($elHeight < docHeight || $elWidth < docWidth) {
        $el.css({
            marginTop: -$elHeight /2,
            //top : 20,
            marginLeft: -$elWidth/2
        })
    } else {
        $el.css({top: 0, left: 0});
    }

    $el.find('a.btn-layerClose').click(function(){
        isDim ? $('.dim-layer').fadeOut() : $el.fadeOut(); // 닫기 버튼을 클릭하면 레이어가 닫힌다.
        return false;
    });

    $('.layer .dimBg').click(function(){
        $('.dim-layer').fadeOut();
        return false;
    });

    $('#contentDiv').scrollTop(0);

}


function requestPoiContentAndShow( poiObj, popup2D, popup3D ) {
    var youtube = "";
    var focusPoiObj = poiObj;
    var infoText = "";
    var poiText = poiObj.biblePlace;

    var youtubeRef2D = "<a href =\"javascript:showYoutubePoi2D()\"' >";
    var youtubeRef3D = "<a href =\"javascript:showYoutubePoi3D()\"' >";
    var youtubeIcon = "<img src=\"biblemap/image/camera-icon.png\" style=\"width:20px; height:20px; vertical-align:middle;\">";

    var textRef = "<a href =\"javascript:showTextPoi()\"' >";
    var textIcon = "<img src=\"biblemap/image/text-icon.png?version=20170904\" style=\"width:20px; height:20px; vertical-align:middle;\">";

    var lineImage = '<div style=\"height: 14px; background: url(biblemap/image/horizon-line.png);\"></div>';

    requestPoiInfo( poiObj, function ( recvPoiObj) {
        if ( recvPoiObj.hasOwnProperty("youtube")) {
            youtube = recvPoiObj["youtube"];
        }

        if ( recvPoiObj.hasOwnProperty("text")) {
            infoText = recvPoiObj["text"];
        }

        showBaseInfoPoi( popup3D, "contentFrame3D" );
        showBaseInfoPoi( popup2D, "contentFrame2D" );

        // poiContentsToTab();

    }, function () {

        popup3D.content.innerHTML = poiText + " ";
        showTitlePoi( popup3D, poiObj.title, "contentFrame3D" );
        popup3D.overlay.setGroundPosition( [poiObj.x, poiObj.y] );


        popup2D.content.innerHTML = poiText + " ";
        showTitlePoi( popup2D, poiObj.title, "contentFrame2D" );
        popup2D.overlay.setPosition( [poiObj.x, poiObj.y] );

    });

    showTitlePoi = function( popup, title , frameName ) {
        if( title == "") {
            return;
        }
        var strLen = ( title.length * 12) + 35;
        popup.content.innerHTML += lineImage;
        popup.content.innerHTML += '<br>';
        popup.content.innerHTML += "<span style=\'font-size:10pt;\'>" + title + "</span>";

        /*
      //   popup.content.innerHTML += '<iframe id=' + frameName +' width=\"'+ strLen + '\" height=\"35\" frameborder = \"0\" sandbox=\"allow-scripts allow-same-origin\" src=\"about:blank\"></iframe>';
        popup.content.innerHTML += '<iframe id=\"contentFrame\" width=\"'+ strLen + '\" height=\"35\" frameborder = \"0\" sandbox=\"allow-scripts allow-same-origin\" src=\"about:blank\">'+'</iframe>';

        // var frame = document.getElementById( frameName );
        var frame = document.getElementById( "contentFrame" );
        if( frame ) {
            var fdoc = frame.contentDocument;
            // var contentString = "<span style=\'font-size:10pt;\'>" + title + "</span>";
            var contentString = "<span style=\'font-size:10pt;\'>" + "ABC" + "</span>";
            fdoc.write( contentString );
        }
        */

    };


    showBaseInfoPoi = function( popup, frameName ){
        if (youtube != "") {
            if( popup.name == "2D")
                popup.content.innerHTML = poiText +" " + youtubeRef2D + youtubeIcon + "</a>";
            if( popup.name == "3D")
                popup.content.innerHTML = poiText +" " + youtubeRef3D + youtubeIcon + "</a>";
        } else
            popup.content.innerHTML = poiText;

        if(infoText != "" ){
            popup.content.innerHTML += "" + textRef + " " + textIcon + "</a>";
        }

        showTitlePoi( popup, poiObj.title, frameName );

        if( popup.name == "2D")
            popup.overlay.setPosition( [poiObj.x, poiObj.y] );
        else
            popup.overlay.setGroundPosition( [poiObj.x, poiObj.y] );
    };

    showBaseInfoPoi2D3D = function(){
      showBaseInfoPoi( popup2D, "contentFrame2D" );
      showBaseInfoPoi( popup3D, "contentFrame3D" );
    };

    showYoutubePoi2D = function() {
        // var scriptRef = "<a href =\"javascript:showBaseInfoPoi()\"' >";
        var scriptRef = "<a href =\"javascript:showBaseInfoPoi2D3D()\"' >";
        var foldIcon = "<img src=\"biblemap/image/fold-icon.png\" style=\"width:20px; height:20px; vertical-align:middle;\">";
        // popup.innerHTML = poiText + " " + scriptRef + foldIcon + "</a>";
        popup2D.content.innerHTML = poiText + " " + scriptRef + foldIcon + "</a>";


        if( infoText!= "" ){
            // popup.innerHTML += textRef + textIcon + "</a>";
            popup2D.content.innerHTML += textRef + textIcon + "</a>";

        }
        // popup.innerHTML += lineImage;
        popup2D.content.innerHTML += lineImage;

        if( poiObj.title != ""){
            // popup.innerHTML += "<br>" + poiObj.title + "<br>";
            popup2D.content.innerHTML += "<br>" + poiObj.title + "<br>";

        }

        popup2D.content.innerHTML += "<iframe width=\"320\" height=\"240\" src=\"" + youtube + "\" frameborder = \"0\" allowfullscreen></iframe>";
        popup2D.overlay.setPosition( [poiObj.x, poiObj.y] );
    };

    showYoutubePoi3D = function() {
        // var scriptRef = "<a href =\"javascript:showBaseInfoPoi()\"' >";
        var scriptRef = "<a href =\"javascript:showBaseInfoPoi2D3D()\"' >";
        var foldIcon = "<img src=\"biblemap/image/fold-icon.png\" style=\"width:20px; height:20px; vertical-align:middle;\">";
        // popup.innerHTML = poiText + " " + scriptRef + foldIcon + "</a>";
        popup3D.content.innerHTML = poiText + " " + scriptRef + foldIcon + "</a>";

        if( infoText!= "" ){
            popup3D.content.innerHTML += textRef + textIcon + "</a>";
        }

        popup3D.content.innerHTML += lineImage;
        if( poiObj.title != ""){
            popup3D.content.innerHTML += "<br>" + poiObj.title + "<br>";
        }

        popup3D.content.innerHTML += "<iframe width=\"320\" height=\"240\" src=\"" + youtube + "\" frameborder = \"0\" allowfullscreen></iframe>";
        popup3D.overlay.setGroundPosition( [poiObj.x, poiObj.y] );
    };


    poiContentsToTab = function(){

        var infoTab = document.getElementById( 'tab3' );
        // infoTab.innerHTML = '<a href=' + '"javascript:moveToPlaceByPoiID( ' + focusPoiObj.id + ')\" style=\"text-decoration:none; font-weight:bold;' + "font-size:\'20px;\'" + 'color: #9C1AC8 \" >' + "[ " + poiText + " ]  " +  '</a>';
        infoTab.innerHTML = '<a href=' + '"javascript:moveToPlaceByPoiID( ' + focusPoiObj.id + ')\" style=\"text-decoration:none; font-weight:bold;' + "font-size:\'30px\';" + 'color: #000000 \" >' + "[ " + poiText + " ]  " +  '</a>';

        var infoObj = { // title : poiText,
            content : infoText
        };

        var strConvText = makeStrongInText( layerManager, focusPoiObj.biblePlace, infoObj );

        // infoTab.innerHTML += infoText;
        infoTab.innerHTML += strConvText;
    };

    showTextPoi = function() {      // tabMenu 에서 정보 보여주기

        poiContentsToTab();

        adjustScrDiv.setIsFullScr("false");

        $("#tab3").scrollTop(0);
        tabMenu.selectTab('tab3Menu');

    };
}


function showTextLayerPopup( title, infoText ){

    var lineImage = '<div style=\"height: 14px; background: url(biblemap/image/horizon-line.png);\"></div>';

    var popupTitle = document.getElementById( 'noticeTitle' );
    popupTitle.innerHTML = "";
    popupTitle.innerHTML += title;
    popupTitle.innerHTML += lineImage;

    var popupContent = document.getElementById( 'noticeContent' );
    popupContent.innerHTML = "";
    // popupContent.innerHTML += poiText;
    // popupContent.innerHTML += lineImage + "<br>";
    popupContent.innerHTML += '<br>' + infoText;

    showNoticePopup( '#infoPopup' );

}



function showIntroBibleMap(  ){

    var lineImage = '<div style=\"height: 14px; background: url(biblemap/image/horizon-line.png);\"></div>';

    var popupTitle = document.getElementById( 'noticeTitle' );
    popupTitle.innerHTML = "공지사항" + lineImage;

    var popupContent = document.getElementById( 'noticeContent' );
    popupContent.innerHTML = "";
    // popupContent.innerHTML += poiText;
    // popupContent.innerHTML += lineImage + "<br>";
    popupContent.innerHTML += '<br>' + '성경내용 안에는 하나님의 역사가 담겨있습니다 <br>';
    popupContent.innerHTML += '하나님의 역사는 사실이며 따라서 성경본문에 등장하는 지명은 대부분 실제 존재하는 위치입니다 <br>';
    popupContent.innerHTML += '지리적 위치에 대한 이해와 더불어 성경을 이해한다면 더욱 큰 확신과 믿음이 생길 것입니다  <br>';
    popupContent.innerHTML += '여러분들이 성경을 가까이 하며 하나님의 역사를 더욱 깊게 알기 원하신다면 성경지도 웹 서비스가 도움이 될 것입니다.</span>';
    popupContent.innerHTML += '<br>';
    popupContent.innerHTML += '<br>';
    popupContent.innerHTML += '본 웹사이트에 포함된 디지털맵 뷰어는 OpenLayers를 기반으로 제작되었으며, OpenLayers의 라이센스는 2-Clause BSD를 따릅니다.</span>';
    popupContent.innerHTML += '<br>';
    popupContent.innerHTML += '<br>';
    popupContent.innerHTML += '본 웹사이트에서 표현되는 디지털 맵 데이터의 일부는 OpenStreetMap을 사용하고 있으며, OpenStreetMap의 라이센스는 CC BY-SA 2.0을 따릅니다.</span>';
    popupContent.innerHTML += '<br>';
    popupContent.innerHTML += '<br>';
    popupContent.innerHTML += '본 웹사이트에 포함된 디지털맵 뷰어는 Cesium과 ol-cesium를 기반으로 제작되었으며, Cesium v1.32의 라이센스는 Apache License 2.0를 따릅니다.</span>';
    popupContent.innerHTML += '<br>';
    popupContent.innerHTML += '<br>';
    popupContent.innerHTML += '본 웹사이트에서 표현되는 DEM 데이터는 STK World Terrain 이며, EU에서 자금을 조달 한 코페르니쿠스 © Analytical Graphics, Inc., © CGIAR-CSI 에서 제공하는 정보입니다.</span>';
    popupContent.innerHTML += '<br>';
    popupContent.innerHTML += '<br>';
    popupContent.innerHTML += '본 웹사이트에서 제공하는 성경지명 정보 가운데 \'-비전성경사전-\' 출처로 표현되는 내용은 \'(사)두란노서원\'에서, \'-성경지명사전-\' 출처로 표현되는 내용은 \'(사)한국컴퓨터선교회\'에서 웹서비스를 통하여 제공하고 있는 내용임을 알려드립니다.</span>';
    popupContent.innerHTML += '<br>';
    popupContent.innerHTML += '<br>';
    popupContent.innerHTML += '본 웹사이트에서 제공되는 위치정보는 일부 오류를 포함할 수 있음을 알려드리며, 공인된 정확한 정보가 수집되는 대로 수정할 것을 알려드립니다.</span>';
    popupContent.innerHTML += '<br>';

    showNoticePopup( '#infoPopup' );

    // window.open("licenseNotice.html?version=20170920", "notice of license", "width=400, height=400, top=0, left=0, location=no, directories=no,resizable=no,status=no,toolbar=no,menubar=no, scrollbars=yes" );

}




function Tooltip( paramMap, cssClassName ) {
    var bibleMap = paramMap;

    var tooltipElement = null;
    this.tooltipArray = [];

    var zOrder = 0;

    this.create = function( poiName, linkedText, coord){

        tooltipElement = document.createElement('div');

        // tooltipElement.className = 'tooltip tooltip-static';
        tooltipElement.className = cssClassName;

        tooltip = new ol.Overlay({
            element: tooltipElement,
            offset: [0, -15],
            positioning: 'bottom-center'
        });
        bibleMap.addOverlay(tooltip);

        tooltipElement.innerHTML = linkedText;


        tooltipElement.setAttribute("id", poiName );
        var strID = "#"+ poiName ;

        $(strID).css( "z-index", zOrder.toString() );

        tooltip.setPosition(coord);
        tooltip.setOffset([0, -7]);

        this.tooltipArray.push( tooltip);
        zOrder +=1;
    };

    this.allRemove = function() {

        zOrder = 0;

        if ( tooltipElement) {
            tooltipElement.parentNode.removeChild( tooltipElement );
            tooltipElement = null;
        }

        for (var idx in this.tooltipArray) {
            var tooltip = this.tooltipArray[idx];
            bibleMap.removeOverlay(tooltip);
        }
    };
}

var BibleChapterList = function() {

    var chapterArray = [];

    setChapterArray = function(  objList ){
        // chapterArray = [];

        for (var idx in objList ) {
            var chapter = objList[idx];
            chapterArray.push( chapter );
        }
    };

    this.getCount = function(){
        return chapterArray.length;
    };

    this.getChapterByNumber = function( number ){
        for( var idx in  chapterArray ){
            var chapter = chapterArray[ idx ];
            if( chapter.bookNumber == number ){
                return chapter;
            }
        }
        return null;
    };

    this.getBookNumberByName = function( chapterName ){
        for( var idx in chapterArray ){
            var chapter = chapterArray[idx];
            if( chapter.title == chapterName ){
                return chapter.bookNumber;
            }
        }
        return -1;

    };

    this.requestBibleChapter = function( callback ){
        var searchParam = {
            type: "ChapterList",
            option: {}
        };

        var jsonStr = JSON.stringify( searchParam );
        // ConsoleLog( "send param : " + jsonStr );

        httpRequest("POST", jsonStr, function( http ) {
            var resObj = JSON.parse(http.responseText);

            if( resObj.result != "undefined" && resObj.result == "fail" ){
                ConsoleLog( "request ChapterList!!! " + resObj.error );
            }
            else {
                if (resObj.length != "undefined") {    // 배열로 받아올 경우
                    setChapterArray( resObj );
                }else{
                    ConsoleLog( "Bible ChapterList Receive Error!!");
                }
            }

            callback();

        }) ;

    };

};

//////////////////////////////////////////////////////////////

function currentHistoryAdminString( newValue ){
    var strObj =  getHistoryAdminStringObj( newValue );

    document.getElementById("range").innerHTML = strObj.title;
    // document.getElementById("historyAdminExplain").innerHTML = strObj.text;

    // $("#historyAdminExplain").scrollTop(0);
}


function eventHistoryAdmin( newVal ){
    // dvPopupCloser.onclick();
    closePopup2D();
    closePopup3D();
    /*
     adjustScrDiv.setIsFullScr("false");

     writeInfoTabHistoryAdmin();
     */

    changeHistoryAdmin( newVal );
    // showHistoryAdmin();
    infoHistoryAdmin();

    setViewMode2D();
}

function writeInfoTabHistoryAdmin(){
    var infoTab = document.getElementById( 'tab4' );

    var newVal = document.getElementById("historyAdmin").value;
    var obj =  getHistoryAdminStringObj( newVal );

    var strConvText;

    infoTab.innerHTML = "<strong><font >" + '[ ' + obj.title + ' ]' + "</font></strong>" +'<br>';

    var infoObj = { // title : poiText,
        content : obj.text
    };

    if( obj.text ) {
        strConvText = makeStrongInText( layerManager, "abc", infoObj );
    }

    infoTab.innerHTML += strConvText;
}


function infoHistoryAdmin(){
    // showHistoryAdmin();

    $("#tab4").scrollTop(0);
    tabMenu.selectTab('tab4Menu');

    adjustScrDiv.setIsFullScr("true");

    var val = document.getElementById("historyAdmin").value;
    changeHistoryAdmin( val );

    setViewMode2D();
}


function showHistoryAdmin(){

    writeInfoTabHistoryAdmin();

    // infoTab.innerHTML = obj.text;
    adjustScrDiv.setIsFullScr("false");
    // adjustScrDiv.setIsFullScr("true");

    $("#tab4").scrollTop(0);
    tabMenu.selectTab('tab4Menu');
}


function changeHistoryAdmin( newValue ){

    currentHistoryAdminString( newValue );

    for (idx in layerManager.layerContainer.layers) {
        var layer = layerManager.layerContainer.layers[idx];
        if (layer.get('historyShow')) {
            layer.set('historyShow', 'false');
        }
    }

    var historyArray = [5, 6, 7, 8, 9, 10, 11, 12,  [ 1, 2, 3, 4 ] ];

    function showHistoryLayer( showId ) {
        for (idx in layerManager.layerContainer.layers) {
            var layer = layerManager.layerContainer.layers[idx];
            var id = layer.get('id');
            if (showId.length) {    // 현재의 국가는 4개의 레이어를 한꺼번에 켜고 꺼야 한다.
                for ( var hID in showId) {
                    var sSubId = showId[hID];
                    if (id == sSubId) {
                        if (layer.get('historyShow')) {
                            layer.set('historyShow', 'true');
                            break;
                        }
                    }
                }
            } else {
                if (id == showId) {
                    if (layer.get('historyShow')) {
                        layer.set('historyShow', 'true');
                        var extent = layer.getSource().getExtent();
                        var view = bibleMap.getView();
                        view.fit( extent, bibleMap.getSize() );
                        break;
                    } else {
                        alert(" historyArray[" + showId + "] : " + historyArray[showId] + ", layerID : " + id + "  has not property historyShow!!!");
                    }
                }
            }
        }
    }

    showHistoryLayer( historyArray[newValue]);
}
