<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>XMLHttpRequest 사용예제</title>
    <script type = "text/javascript" src = "httpRequest.js"></script>
</head>
<body>
<form name="nameFrame" accept-charset="utf-8">
    <input type="text" name="name">
    <input type="button" value="이름 입력(GET 방식)" onclick="requestMessage( 'GET', 'get_name_process.jsp')">
    <input type="button" value="이름 입력(POST 방식)" onclick="requestMessage( 'POST', 'get_name_process.jsp')">
    <div id="message1"></div>
</form>
<br>
------------------------------
<br>
<form name="fileFrame" accept-charset="utf-8">
    <input type="text" name="name">
    <input type="button" value="파일명 입력" onclick="requestFile()">
    <div id="message2"></div>
</form>
<br>
------------------------------
<br>
<form name="getWeather" accept-charset="utf-8">
    <input id = "city" /><br>
    <input type="button" value = "Get Weather" onclick="requestWeather();"/>
    <div id="message3"></div>
    <br>
    <input type="button" value = "Test" onclick="requestNodeJS();"/>
</form>

<script>

    function showRequestResult( http ){
        document.getElementById("message1").innerHTML = http.responseText;
    }

    function requestMessage( method, url ){
        document.getElementById("message1").innerHTML = "";
        param = nameFrame.name.value;
        url = url + "?name=" + encodeURIComponent(param);   // 어떤 시스템에서나 읽을 수 있는 ascii 문자로 변환한
        httpRequest( method, url, showRequestResult );
    }


    function showFileContents( http ){
        if( http.dataType == "text/plain") {
            document.getElementById("message2").innerHTML = http.responseAttachText + "</br>" + http.responseText;
            // }else if( http.dataType == "image/png") {
        } else {
            var strData = http.responseText;
            if( typeof strData == "string") {
                alert( "length : " + strData.length + "\r\n" + http.responseAttachText );
            }

            /*
             document.getElementById("message2").innerHTML = http.responseAttachText;
             var img = document.createElement("img");
             img.src = http.responseBody;
             */
        }
    }


    function requestFile(){
        document.getElementById("message2").innerHTML = "";
        fileName = fileFrame.name.value;
        httpRequest( "GET", fileName, showFileContents );
    }


    parseJSONtoText = (function(){
        var strText = "";

        function parseJsonObj( jsonObj ){
            for( prop in jsonObj ){
                if( jsonObj.hasOwnProperty(prop) && typeof( jsonObj[prop] ) == "object" ){
                    strText += "<br>< " + prop + " ><br>";
                    parseJsonObj( jsonObj[prop]);
                }else{
                    strText += prop + " : " + jsonObj[prop] + ", ";
                }
            }
        }
        return function( jsonObj ){
            strText = "";
            parseJsonObj( jsonObj);
            return strText;
        }

    }());


    function showWeatherInfo( http ){
        var weatherInfo = "";
        console.log( http.dataType );
        weatherInfo = http.responseText + "<br><br>";

        var weatherObj = JSON.parse( http.responseText );
        weatherInfo += parseJSONtoText( weatherObj );
        document.getElementById("message3").innerHTML = weatherInfo;
    }

    function requestWeather( ){
        document.getElementById("message3").innerHTML = "";
        var cityName = document.getElementById("city").value;
        console.log( cityName );
        var host = "http://api.openweathermap.org//data/2.5/weather";
        url = host + "?q="+cityName+"&APPID=a24c349975e7c26f39a120927e512cd3";
        console.log(url);

        httpRequest( "GET", url, showWeatherInfo );
        return false;
    }

    function showResponseNodeJS( http ){
        alert( http.responseText );
    }

    function requestNodeJS(){
        httpRequest("GET", "http://13.124.86.217:8081/hello.html", showResponseNodeJS )

    }

</script>

</body>
</html>