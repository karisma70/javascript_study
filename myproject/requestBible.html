<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Bible 검색 예제</title>
    <script type = "text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/1.7.3/socket.io.js"></script>
    <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.6.2/jquery.js"></script>
    <script type = "text/javascript" src = "httpRequest.js"></script>
</head>
<body>
<form name="bibleSearch" accept-charset="utf-8">
    <input type="text" name="title">
    <input type="text" name="chapter"> 장
    <input type="text" name="paragraph"> 절
    <input type="button" value="검색" onclick="requestBibleByChapter()">
</form>
<br>
<form name="bibleWordSearch" accept-charset="utf-8">
    <input type="text" name="word"> 검색어
    <input type="button" value="검색" onclick="requestBibleByWord()">
</form>
<br>
<textarea id = "receiveMsg" name = "comment" cols = "80" rows = "50"></textarea>

<script>

    function requestBibleByWord(){
        $('#receiveMsg').empty();
        var searchParam = {
            type: "Word",     // book, chapter, paragraph 등으로 구성된 검색
            option: {}
        };

        if( bibleWordSearch.word.value == "" ){
            alert ("Please insert word! for search!");
        }else{
            searchParam.option.content= { $regex : bibleWordSearch.word.value };
            var jsonStr = JSON.stringify( searchParam );
            console.log( "send param : " + jsonStr );

            url = "http://13.124.86.217:8082?" + jsonStr;
            httpRequest("POST", url, function( http ){
                var resObj = JSON.parse( http.responseText );
                if( resObj.length != "undefined" ) {    // 배열로 받아올 경우
                    for (idx in resObj) {
                        // console.log(resObj[idx]);
                        $('#receiveMsg').append( resObj[idx].title + " " + resObj[idx].chapter + ":" + resObj[idx].paragraph + "\r\n" +  resObj[idx].content + "\r\n" );
                    }
                } else {
                    $('#receiveMsg').append( resObj.title + " " + resObj.chapter + ":" + resObj.paragraph + "\r\n" +  resObj.content + "\r\n" );
                }
            } );
        }

    }

    function requestBibleByChapter(){
        $('#receiveMsg').empty();
        var searchParam = {
            type: "Args",     // book, chapter, paragraph 등으로 구성된 검색
            option: {}
            };

        function consistSearchOpt( obj ){
            searchParam.option[obj.name] = obj.value;
        }

        if( bibleSearch.title.value == "" ){
            alert ("Please insert title!!");
            return;
        } else {
            consistSearchOpt( bibleSearch.title  );
        }

        if( bibleSearch.chapter.value == "" ){
            alert ("Please insert chapter!!");
            return;
        } else {
            consistSearchOpt( bibleSearch.chapter );
        }


        if( bibleSearch.paragraph.value != "" ){
            consistSearchOpt( bibleSearch.paragraph );
        }

        var jsonStr = JSON.stringify( searchParam );
        console.log( "send param : " + jsonStr );

        url = "http://13.124.86.217:8082?" + jsonStr;
        httpRequest("POST", url, function( http ){
            var resObj = JSON.parse( http.responseText );
            if( resObj.length != "undefined" ) {    // 배열로 받아올 경우
                for (idx in resObj) {
                    // console.log(resObj[idx]);
                    $('#receiveMsg').append( resObj[idx].title + " " + resObj[idx].chapter + ":" + resObj[idx].paragraph + "\r\n" +  resObj[idx].content + "\r\n" );
                }
            } else {
                $('#receiveMsg').append( resObj.title + " " + resObj.chapter + ":" + resObj.paragraph + "\r\n" +  resObj.content + "\r\n" );
            }
        } );
    }

</script>

</body>
</html>